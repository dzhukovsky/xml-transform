trigger:
- main

pool:
  vmImage: windows-latest

steps:
- task: NodeTool@0
  displayName: Install Node.js
  inputs:
    versionSpec: 16.x

- script: |
    run vsix:build
    install -g copyfiles
    run vsix:copy
  displayName: Build
  workingDirectory: $(Build.SourcesDirectory)

- task: Npm@1
  displayName: Build
  inputs:
    command: custom
    workingDir: $(Build.SourcesDirectory)
    customCommand: run vsix:build

- task: ArchiveFiles@2
  displayName: Archive Files
  inputs:
    rootFolderOrFile: $(Build.SourcesDirectory)/out
    includeRootFolder: false
    archiveType: zip
    archiveFile: $(Build.ArtifactStagingDirectory)/package.zip
    replaceExistingArchive: true

- task: PublishBuildArtifacts@1
  displayName: Publish Artifacts
  inputs:
    PathtoPublish: $(Build.ArtifactStagingDirectory)
    ArtifactName: drop
    publishLocation: Container